let FormAutoFill=new Vue({el:"#app",data:{gas:"https://script.google.com/macros/s/AKfycbxUGvGKKYw9J0LSx7fIj70FDIt1rY8ARTdU_FYQ8s4PsHvnuidabk6LchFJEopPhyPw/exec",main_date:"",persons:{},person:{classroom:[],classroomnum:[]},sessions:[],formAction:"https://docs.google.com/forms/u/0/d/e/1FAIpQLSdmjNIW62KESvCeQdkFPjYqFJddL2yLP-_GnG14IfdhN9QYag/formResponse",input:{main_date:"entry.1728672130",category:"entry.1482655790",borrower:"entry.1839271513",message:"entry.976702063",classroom:"entry.612910922",num:"entry.2022607349",end_date:"entry.1438188391"},loading:!1},methods:{clearClassroom(){this.person.end_date=void 0,this.person.classroom=[]},clearDate(){this.main_date=void 0,this.person.end_date=void 0,this.person.classroom=[],this.sessions=[]},submit(){var s=s=>void 0!==s&&""!==s;if(s(this.main_date)&&s(this.person?.category)&&s(this.person?.borrower)&&s(this.person?.message)&&0<this.person.classroom.length&&s(this.person?.num)&&s(this.person?.end_date)){if("iPad"===this.person.category){this.person.classroomcheck=this.person.classroom,this.person.classroomchecknum=[];for(var e of this.person.classroomcheck)for(let s=0;s<this.person.classroomnum.length;s+=3)if(this.person.classroomnum[s]===e){this.person.classroomchecknum.push(this.person.classroomnum[s+1]);break}this.person.minNumber=Math.min(...this.person.classroomchecknum)}"iPad"===this.person.category&&this.person.minNumber<this.person.num?alert("借用數量超過剩餘數量，請確認使用課堂及數量！"):(s=["第一節","第二節","第三節","第四節","第五節","學藝營","第六節","第七節","安親班","暑輔第一節","暑輔第二節","暑輔第三節","暑輔下午班"].filter(s=>this.person.classroom.includes(s)),s=`${this.input.main_date}=${this.main_date}&${this.input.category}=${this.person.category}&${this.input.borrower}=${this.person.borrower}&${this.input.message}=${this.person.message}&${this.input.classroom}=${s}&${this.input.num}=${this.person.num}&${this.input.end_date}=`+this.person.end_date,fetch(this.formAction+"?"+s,{method:"POST"}).catch(s=>{alert("提交成功。"),location.reload()}))}else alert("請填寫所有項目！")}},watch:{main_date:function(s){let o=new Date(s),t=o.getUTCDay();var e=o.getFullYear();let n,r=(this.sessions=[],new Date(e+"-07-03")),i=new Date(e+"-08-23");if(void 0!==s&&"iPad"===this.person.category){this.loading=!0;e=this.gas+"?id="+this.main_date;fetch(e,{method:"POST"}).then(s=>s.json()).then(s=>{this.person.classroomnum=s.classroomnum,n=o>r&&o<i?[27,30,33,36]:3===t?[0,3,6,9,12,15]:[0,3,6,9,12,18,21,24],this.sessions=n.map(s=>({name:this.person.classroomnum[s],remaining:"剩餘數量："+this.person.classroomnum[s+1],borrow:this.person.classroomnum[s+2]})),this.loading=!1}).catch(s=>{this.loading=!1,alert('網站發生錯誤，按"確定"重新整理網頁'),location.reload()})}else if(void 0!==s){let e=["第一節","第二節","第三節","第四節","第五節","學藝營","第六節","第七節","安親班","暑輔第一節","暑輔第二節","暑輔第三節","暑輔下午班"];n=o>r&&o<i?[9,10,11,12]:3===t?[0,1,2,3,4,5]:[0,1,2,3,4,6,7,8],this.sessions=n.map(s=>({name:e[s],remaining:"",borrow:""}))}}}});
